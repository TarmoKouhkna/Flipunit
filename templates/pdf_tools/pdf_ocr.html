{% extends 'base.html' %}

{% block title %}OCR PDF - Make Scanned PDFs Searchable Online - {{ SITE_NAME }}{% endblock %}
{% block meta_description %}Free online PDF OCR tool - Convert scanned PDFs to searchable text. Make image-based PDFs editable and searchable.{% endblock %}

{% block content %}
<div class="card">
    <h1 class="card-title">OCR PDF - Make Scanned PDFs Searchable</h1>
    <p style="color: var(--text-secondary); margin-bottom: 2rem;">Convert scanned PDFs to searchable PDFs using OCR (Optical Character Recognition)</p>
    
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    
    {% if not pytesseract_available or not pdf2image_available %}
    <div class="alert alert-info">
        <strong>Note:</strong> OCR functionality requires pytesseract and pdf2image libraries, as well as Tesseract OCR engine.
        {% if not pytesseract_available %}
        <br>Install: pip install pytesseract
        {% endif %}
        {% if not pdf2image_available %}
        <br>Install: pip install pdf2image && brew install poppler (macOS) or apt-get install poppler-utils (Linux)
        {% endif %}
        <br>Install Tesseract: brew install tesseract (macOS) or apt-get install tesseract-ocr (Linux)
    </div>
    {% endif %}
    
    <form method="post" enctype="multipart/form-data" class="converter-tool">
        {% csrf_token %}
        <div class="form-group">
            <label class="form-label">Upload PDF File</label>
            <div class="file-upload-area">
                <input type="file" name="pdf_file" id="pdf_file" accept=".pdf" required>
                <p>Click to select or drag and drop a PDF file</p>
            </div>
        </div>
        
        <button type="submit" class="btn btn-primary btn-block" id="submit-btn" style="margin-top: 1.5rem;">
            <span id="btnText">Make PDF Searchable</span>
            <span id="btnLoader" style="display: none;">⏳ Processing...</span>
        </button>
    </form>
    
    <div style="margin-top: 2rem; padding: 1rem; background: var(--surface); border-radius: 6px;">
        <h3>How it works:</h3>
        <ol class="list-indent" style="margin-top: 0.5rem;">
            <li>Upload a scanned PDF or image-based PDF</li>
            <li>OCR technology extracts text from each page</li>
            <li>Download a new searchable PDF with invisible text layer</li>
            <li>The PDF will be searchable and selectable</li>
        </ol>
        <p style="margin-top: 1rem; color: var(--text-secondary);">
            <strong>Note:</strong> OCR accuracy depends on image quality. Clear, high-resolution scans produce better results.
        </p>
    </div>
</div>

<a href="{% url 'pdf_tools:index' %}" class="btn btn-secondary">← Back to PDF Tools</a>

{% block extra_js %}
<style>
/* Override CSS to make file input visible and clickable */
.file-upload-area input[type="file"] {
    display: block !important;
    opacity: 0;
    position: absolute;
    width: 100%;
    height: 100%;
    cursor: pointer;
    top: 0;
    left: 0;
    z-index: 2;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.converter-tool');
    const fileInput = document.getElementById('pdf_file');
    const uploadArea = document.querySelector('.file-upload-area');
    const submitBtn = document.getElementById('submit-btn');
    
    // Style file input to overlay the upload area (like other PDF tools)
    if (fileInput && uploadArea) {
        // Ensure upload area is clickable
        uploadArea.style.cursor = 'pointer';
        uploadArea.style.position = 'relative';
        
        // Backup click handler in case main.js doesn't work
        uploadArea.addEventListener('click', function(e) {
            // Only trigger file input if click is not directly on the input itself
            if (e.target !== fileInput && !fileInput.contains(e.target)) {
                e.preventDefault();
                fileInput.click();
            }
        }, { capture: false });
    }
    
    // Handle file selection
    fileInput.addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
            uploadArea.querySelector('p').textContent = 'Selected: ' + e.target.files[0].name;
        }
    });
    
    // Prevent click event from bubbling to the upload area
    fileInput.addEventListener('click', function(e) {
        e.stopPropagation();
    });
    
    // Handle form submission
    const btnText = document.getElementById('btnText');
    const btnLoader = document.getElementById('btnLoader');
    
    form.addEventListener('submit', function(e) {
        if (!fileInput.files.length) {
            e.preventDefault();
            alert('Please select a PDF file first.');
            return;
        }
        
        // Show loading state
        btnText.style.display = 'none';
        btnLoader.style.display = 'inline';
        submitBtn.disabled = true;
        
        // Reset button after download starts (for file downloads that don't reload the page)
        // If the page reloads (error case), the button will be reset automatically
        setTimeout(function() {
            btnText.style.display = 'inline';
            btnLoader.style.display = 'none';
            submitBtn.disabled = false;
        }, 2000); // Reset after 2 seconds - enough time for download to start
    });
});
</script>
{% endblock %}
{% endblock %}



